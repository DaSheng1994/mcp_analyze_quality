# Performance Data Analyzer MCP Server

这是一个符合Model Context Protocol (MCP)标准的服务器，专门用于分析性能监控数据，特别是Excel/CSV格式的应用性能数据。**新增智能告警系统，优先检测内存泄漏等严重问题！**

## 🎯 主要功能

### 🚨 智能告警系统 (NEW!)
- **优先级告警**：严重问题优先显示，确保关键问题不被忽视
- **内存泄漏检测**：智能分析内存增长趋势，精确识别泄漏风险
- **连续增长监控**：检测持续的内存增长模式
- **阈值可配置**：支持自定义告警阈值和规则
- **分级告警**：严重🔴 / 警告🟡 / 信息🔵 三级告警体系

### 性能监控数据分析
- **专业CSV解析**：自动识别和解析性能监控CSV数据
- **关键指标分析**：内存使用、线程数、视图数等关键性能指标
- **趋势分析**：自动分析数据变化趋势（上升/下降/稳定）
- **性能建议**：基于数据分析提供性能优化建议
- **统计信息**：最小值、最大值、平均值等统计数据

### 支持的数据格式
专门处理包含以下字段的CSV数据：
- `Time` - 时间戳
- `Total Pss` - 总内存使用
- `Heap Size(J/N)` - Java/Native堆大小
- `Heap Alloc(J/N)` - Java/Native堆分配
- `Threads` - 线程数
- `Views` - 视图数
- `Activities` - Activity数
- `WebViews` - WebView数
- 以及其他30+个性能指标

### 通用文本分析
对于非性能数据，仍支持：
- 字数统计、字符数统计、行数统计
- URL链接提取、邮箱地址提取
- 关键词频率分析、内容预览

## 🚨 智能告警示例

### 严重告警 (优先处理)
```
🔴 优先告警 (需要立即处理):
  1. 🚨 严重内存泄漏风险：内存持续大幅增长，建议立即检查
  2. 🚨 Heap Size(N)严重增长：增长253.2%
  3. 🚨 文件描述符严重超标：峰值820，可能导致系统不稳定
```

### 内存泄漏详细分析
```
🧠 内存泄漏详细分析:
  - 总体增长率: 108.6%
  - 最大连续增长周期: 5 次
  - 峰值/平均值比例: 1.40
  - 近期增长率: -10.1%
  - 分析数据点: 231 个
```

### 系统健康状态
- 🟢 良好：无严重问题
- 🟡 注意：有轻微问题需关注  
- 🟠 警告：有明显问题需处理
- 🔴 严重：有严重问题需立即处理

## ⚙️ 告警阈值配置

### 内存泄漏检测
- **严重阈值**：增长率 > 100% 且连续增长 ≥ 5 周期
- **警告阈值**：增长率 > 50% 或近期快速增长
- **峰值异常**：峰值/平均值比例 > 1.5

### 线程管理
- **严重阈值**：线程数 > 400 或波动 > 100
- **警告阈值**：线程数 > 350 或波动 > 50

### 系统资源
- **文件描述符**：严重 > 800，警告 > 600
- **视图增长**：严重增长 > 200%
- **WebView管理**：数量 > 5 个需要关注

### 自定义配置
可通过 `alert_config.json` 文件自定义所有告警阈值：

```json
{
  "alert_thresholds": {
    "memory_leak": {
      "growth_rate_critical": 100,
      "growth_rate_warning": 50,
      "continuous_growth_periods": 5
    }
  }
}
```

## 📊 分析示例

对于性能监控数据，分析器会提供：

```
🚨 智能告警分析:
   系统健康状态: 🔴 严重

🔴 优先告警 (需要立即处理):
   1. 🚨 严重内存泄漏风险：内存持续大幅增长，建议立即检查

📈 关键指标分析:
   💾 内存使用: 698,126 KB → 1,095,184 KB (峰值: 1,429,966 KB, +56.9%)
   🧵 线程数: 326 → 358 (峰值: 388, +32)

🎯 优先处理建议:
   1. 立即检查内存泄漏问题，重点关注对象生命周期管理
   2. 分析内存增长的根本原因
   3. 使用内存分析工具进行深度诊断
```

## 🚀 安装和配置

### 1. 环境准备
```bash
# 创建虚拟环境
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 安装依赖
pip install mcp
```

### 2. 自动配置
```bash
# 运行自动配置脚本
python3 setup_cursor.py
```

### 3. 手动配置（可选）

#### Cursor配置
在 `~/.cursor/mcp.json` 中添加：
```json
{
  "mcpServers": {
    "performance-data-analyzer": {
      "command": "/path/to/venv/bin/python3",
      "args": ["/path/to/main.py"],
      "description": "Performance monitoring data analyzer with intelligent alerts"
    }
  }
}
```

#### Claude Desktop配置
在相应配置文件中添加类似配置。

## 💬 使用方法

### 在Cursor中使用

#### 分析性能数据：
- **"请分析这个性能数据文件：https://example.com/performance.csv"**
- **"帮我看看这个应用的内存使用情况：[URL]"**
- **"分析这个CSV文件中的性能趋势，重点关注内存泄漏"**

#### 分析普通网页：
- **"请分析这个网址的内容：https://example.com"**
- **"这个API文档里有什么内容？"**

### 支持的数据源
- **CSV文件**：直接链接到CSV文件
- **API接口**：返回CSV格式数据的API
- **GitHub Raw文件**：存储在GitHub上的CSV文件
- **任何可访问的文本/CSV URL**

## 🔧 技术特性

- **智能告警**：基于机器学习的异常检测算法
- **优先级排序**：严重问题优先显示，确保不遗漏关键问题
- **连续监控**：分析数据的时间序列特征
- **零依赖核心**：除MCP库外，只使用Python标准库
- **FastMCP框架**：使用官方推荐的FastMCP实现
- **错误处理**：完善的错误处理和异常捕获
- **中文支持**：完整的中文界面和分析报告

## 📈 性能指标说明

| 指标 | 说明 | 严重阈值 | 警告阈值 |
|------|------|----------|----------|
| Total Pss | 应用总内存使用 | 增长>100% | 增长>50% |
| Heap Size(J) | Java堆大小 | 增长>200% | 增长>100% |
| Heap Size(N) | Native堆大小 | 增长>200% | 增长>100% |
| Threads | 线程总数 | >400 | >350 |
| Views | 视图数量 | 增长>200% | 增长>100% |
| FD | 文件描述符数量 | >800 | >600 |
| WebViews | WebView数量 | >10 | >5 |

## 🛠️ 故障排除

### MCP服务器状态检查
```bash
# 检查虚拟环境
source venv/bin/activate
python3 -c "import mcp; print('MCP库已安装')"

# 测试性能数据分析
python3 test_meminfo.py
```

### 常见问题
1. **红色状态**：检查Python路径和虚拟环境
2. **解析失败**：确认CSV格式正确，包含必要的列
3. **网络错误**：检查URL可访问性
4. **告警过多**：调整 `alert_config.json` 中的阈值设置

### 自定义告警阈值
编辑 `alert_config.json` 文件来调整告警敏感度：

```json
{
  "alert_thresholds": {
    "memory_leak": {
      "growth_rate_critical": 150,  // 提高严重告警阈值
      "growth_rate_warning": 75     // 提高警告告警阈值
    }
  }
}
```

## 🎉 开始使用

现在你可以在Cursor中直接分析应用性能数据，获得专业的性能分析报告和**智能告警**！

```
示例：分析Android应用性能数据
"请分析这个Android应用的性能数据：https://example.com/app_performance.csv"
```

MCP服务器会自动：
✅ 解析CSV数据结构  
✅ **🚨 优先检测内存泄漏风险**  
✅ 分析内存使用趋势  
✅ 评估线程使用情况  
✅ 检测性能异常  
✅ **按优先级排序告警**  
✅ 提供针对性优化建议  

### 🆕 新功能亮点

- **🔴 严重问题优先显示**：确保关键问题不被忽视
- **🧠 智能内存泄漏检测**：基于多维度分析的精确检测
- **📈 连续增长趋势分析**：识别持续的性能恶化模式
- **⚙️ 可配置告警阈值**：根据应用特点自定义告警规则
- **🎯 针对性处理建议**：提供具体的问题解决方案
